{include="header"}
<!--
Copyright (C) 2016 Joe Nilson <joenilson at gmail.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<link href="plugins/distribucion/view/css/bootstrap-select.min.css" rel="stylesheet" type="text/css"/>
<script src="plugins/distribucion/view/js/bootstrap-select.min.js" type="text/javascript"></script>
<script src="plugins/distribucion/view/js/plugins/jquery.tablecheckbox.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function(){
        $("#fecha").datepicker({
            dateFormat: 'yy-mm-dd'
        });

        $('.selectpicker').selectpicker({
            noneSelectedText: 'Nada Seleccionado'
        });
        $('table').tablecheckbox();
    });
</script>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="col-sm-12">
                <h3>
                    <span class="glyphicon glyphicon-print"></span>&nbsp;
                    Impresi&oacute;n de Rutas de clientes
                    <a href="{$fsc->url()}" class='btn btn-xs btn-default'>
                        <span class="glyphicon glyphicon-refresh"></span>
                    </a>
                </h3>
            </div>
            <div class='col-sm-12'>
                <p class="help-block">
                    <span class="fa fa-angle-right"></span>
                    Los clientes deben estar colocados en Rutas para poder mostrar este listado correctamente y la Ruta debe poseer un Vendedor asignado, que no es un agente.
                </p>
                <hr>
            </div>
        </div>

    </div>
    <div class="col-sm-12">
        <form class="form" action="{$fsc->url()}" method="POST" id="f_buscar">
            <input type="hidden" name="tipo" value="">
            <input type="hidden" name="rutas" value="{$fsc->ruta}">
            <input type="hidden" name="vendedores" value="{$fsc->codvendedor}">
            <div class="form-group col-sm-3">
                <label for="almacen" class="control-label"><b>Almacen</b></label>
                <select class="form-control selectpicker input-sm" name="codalmacen" id="codalmacen" onchange="this.form.tipo.value='';this.form.submit();">
                    <option value="">----</option>
                    {loop="$fsc->almacen->all()"}
                    <option value="{$value->codalmacen}" {if="$fsc->codalmacen==$value->codalmacen"}selected{/if}>{$value->nombre}</option>
                    {/loop}
                </select>
            </div>
            <div class="form-group col-sm-3">
                <label for="codvendedor" class="control-label"><b>Vendedor</b></label>
                <select class="form-control selectpicker input-sm" multiple name="codvendedor" id="codvendedor" onchange="this.form.tipo.value='';this.form.vendedores.value=$('#codvendedor').val();">
                    <option value="">Vendedor</option>
                    {loop="$fsc->vendedores"}
                    <option value="{$value->codagente}" {if="$value->seleccionado"}selected{/if}>{$value->nombre}</option>
                    {/loop}
                </select>
            </div>
            <div class="form-group col-sm-3">
                <label for="codruta" class="control-label"><b>Ruta</b></label>
                <select class="input-sm form-control selectpicker" multiple name="codruta" id="codruta">
                    {loop="$fsc->rutas"}
                    <option value="{$value->ruta}" {if="$value->seleccionada"}selected{/if}>{$value->descripcion}</option>
                    {/loop}
                </select>
            </div>
            <div class="form-group col-sm-3">
                <label for="fecha" class="control-label"><b>Fecha de Visita</b></label>
                <div class="input-group">
                    <input class="form-control input-sm" type="text" required autocomplete="off" name="fecha" id="fecha" value="{$fsc->fecha}" placeholder="Fecha Reparto">
                    <div class="input-group-btn">
                        <button type="submit" class="btn btn-primary btn-sm" onclick="this.form.tipo.value='busqueda';this.form.rutas.value=$('#codruta').val();"><span class="glyphicon glyphicon-search"></span></button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="row">
        <div class="col-sm-1">
            <button class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-print"></span>&nbsp; Imprimir</button>
        </div>
    </div>
    <div class="row" style="margin-top: 10px">
        <table class="table table-responsive">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox">
                    </th>
                    <th>Codigo</th>
                    <th>Ruta</th>
                    <th>Dias de visita</th>
                    <th>Clientes</th>
                    <th>Vendedor</th>
                    <th>Almacen</th>
                </tr>
            </thead>
            <tbody>
                {loop="$fsc->rutas_listadas"}
                <tr>
                    <td><input type="checkbox" class="checkbox text-center" name="ruta" value="{$value->ruta}"></td>
                    <td>{$value->ruta}</td>
                    <td>{$value->descripcion}</td>
                    <td>
                        {if="$value->lunes"}<span class="label label-info">Lunes</span>&nbsp;{/if} 
                        {if="$value->martes"}<span class="label label-info">Martes</span>&nbsp;{/if} 
                        {if="$value->miercoles"}<span class="label label-info">Miercoles</span>&nbsp;{/if}
                        {if="$value->jueves"}<span class="label label-info">Jueves</span>&nbsp;{/if}
                        {if="$value->viernes"}<span class="label label-info">Viernes</span>&nbsp;{/if}
                        {if="$value->sabado"}<span class="label label-info">Sabado</span>&nbsp;{/if}
                        {if="$value->domingo"}<span class="label label-info">Domingo</span>{/if}
                    </td>
                    <td>{$value->cantidad}</td>
                    <td>{$value->nombre}</td>
                    <td>{$value->codalmacen}</td>
                </tr>
                {/loop}
            </tbody>
        </table>
    </div>
    <div class="row">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>CÃ³digo</th>
                    <th>Cliente</th>
                    <th>Direcci&oacute;n</th>
                    <th>Ruta</th>
                    <th>Canal</th>
                    <th>Subcanal</th>
                </tr>
            </thead>
            <tbody>
                {loop="$fsc->clientes"}
                    <tr>
                        <td>{$value->codcliente}</td>
                        <td>{$value->nombre_cliente}</td>
                        <td>{$value->direccion}</td>
                        <td>{$value->ruta} {$value->ruta_descripcion}</td>
                        <td>{$value->canal} {$value->canal_descripcion}</td>
                        <td>{$value->subcanal} {$value->subcanal_descripcion}</td>
                    </tr>
                {/loop}
            </tbody>
        </table>
        
    </div>
</div>
{include="footer"}
