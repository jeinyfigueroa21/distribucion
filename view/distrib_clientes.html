<!--
Copyright (C) 2015 Joe Nilson <joenilson@gmail.com>

 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
{include="header"}
<script src="plugins/distribucion/view/js/bootbox.min.js" type="text/javascript"></script>
<style>
.active { background-color: #006687 !important; border-color: #004b63 !important; color: #fff !important; }    
</style>
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            <a class="btn btn-sm btn-default" href="{$fsc->url()}" title="Recargar la página">
                <span class="glyphicon glyphicon-refresh"></span>
            </a>
            Configuración de Datos Maestros
        </h3>
    </div>
    <div class="panel-body">
        <div class="col-md-2 col-sm-3">
            <div class="btn-group-vertical" role="group" aria-label="...">
                <button type="button" id="b_supervisores" value="panel_supervisores" onclick="botonActivo(this)" role="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-sunglasses pull-left"></span> &nbsp; Supervisores
                </button>             
                <button type="button" id="b_vendedores" value="panel_vendedores" onclick="botonActivo(this)" role="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-user pull-left"></span> &nbsp; Vendedores
                </button>
                <button type="button" id="b_rutas" value="panel_rutas" onclick="botonActivo(this)" role="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-road pull-left"></span> &nbsp; Rutas
                </button>
                <button type='button' id="b_canales" value="panel_canales" onclick="botonActivo(this)" role="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-align-justify pull-left"></span> &nbsp; Canales
                </button>
                <button type="button" id="b_subcanales" value="panel_subcanales" onclick="botonActivo(this)" role="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-list pull-left"></span> &nbsp; Subcanales
                </button>
            </div>
        </div>
        <div class="col-md-10 col-sm-9">
            <div class="panel panel-info" id="panel_central">
                <div class="panel-heading">
                    <h3 class="panel-title">Datos maestros de distribución para los clientes</h3>
                </div>
                <div class="panel-body">
                    <p align="justify">Para el correcto uso del módulo de distribución para los clientes se debe crear como mínimo un Supervisor, un vendedor, una ruta, un canal y un subcanal, para ser asignado al cliente.</p>
                    <p align="justify">Si adicional a esto se quiere utilizar el plugin de geolocalización de clientes, se debe agregar en la data maestra de los clientes las coordenadas de los mismos.</p>
                    <p align="justify">A continuación seleccione una opción del menú de la izquierda para agregar la información básica.</p>
                    <div class="alert alert-warning">Es necesario que configure como mínimo un empleado con cargo <b>Supervisor</b> y uno con cargo <b>Vendedor</b></div>
                </div>
            </div>
            <div class="panel panel-info hidden" id="panel_supervisores">
                <div class="panel-heading">
                    <h3 class="panel-title">Supervisores</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="text-left"><a href="{$fsc->almacen->url()}">Almacén</a></th>
                                <th class="text-left">Supervisor</th>
                                <th class="text-center">Activo</th>
                                <th width="120"></th>
                            </tr>
                        </thead>
                        {loop="$fsc->supervisores_asignados"}
                        <form name="f_supervisores" id="f_supervisores" method="POST" action="{$fsc->url()}">
                            <tr{if="!$value1->estado"} class="danger"{/if}>
                                <td>
                                    <select name="codalmacen" class="form-control">
                                        {loop="$fsc->almacen->all()"}
                                            {if="$value1->codalmacen==$value2->codalmacen"}
                                                <option value="{$value2->codalmacen}" selected="">{$value2->nombre}</option>
                                            {else}
                                                <option value="{$value2->codalmacen}">{$value2->nombre}</option>
                                            {/if}
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <input type="text" name="agente" readonly value="{$value1->nombre}" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            {if="$value->estado"}
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                            {else}
                                            <input type="checkbox" name="estado" value="TRUE"/>
                                            {/if}
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <input type='hidden' name='codagente' value='{$value1->codagente}'>
                                        <input type='hidden' name='type' value='supervisor'>
                                        {if="$fsc->allow_delete"}
                                            {if="$value->tiene_asignados"}
                                                <a class="btn btn-sm btn-warning pull-left" onclick="bootbox.alert('No puedes eliminar este Supervisor porque tiene vendedores asignados.')">
                                                    <span class="glyphicon glyphicon-lock"></span>
                                                </a>
                                            {else}
                                                <button class="btn btn-sm btn-danger" type="button" title="Eliminar" onclick="borrar('Supervisor','{$value->codagente}','{$value->codalmacen}')">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                                document.f_supervisores.submit();" title="Guardar">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </form>
                        {/loop}
                        <form name="n_supervisores" id="n_supervisores" action="{$fsc->url()}" method="post" class="form">
                            <tr class="info">
                                <td>
                                    <select name="codalmacen" class="form-control">
                                        {loop="$fsc->almacen->all()"}
                                        <option value="{$value->codalmacen}">{$value->nombre}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <select name="codagente" class="form-control">
                                        {loop="$fsc->supervisores_libres"}
                                        <option value="{$value->codagente}">{$value->codagente} - {$value->nombre} {$value->apellidos}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <input type='hidden' name='type' value='supervisor'>
                                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                            document.n_supervisores.submit();" title="Guardar">
                                        <span class="glyphicon glyphicon-floppy-disk"></span>
                                    </button>
                                </td>
                            </tr>
                        </form>
                    </table>
                </div>
            </div>
            <div class="panel panel-info hidden" id="panel_vendedores">
                <div class="panel-heading">
                    <h3 class="panel-title">Vendedores</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="text-left"><a href="{$fsc->almacen->url()}">Almacén</a></th>
                                <th class="text-left">Supervisor Responsable</th>
                                <th class="text-left">Vendedor</th>
                                <th class="text-center">Activo</th>
                                <th width="120"></th>
                            </tr>
                        </thead>
                        {loop="$fsc->vendedores_asignados"}
                        <form name="f_vendedores" id="f_vendedores" method="POST" action="{$fsc->url()}">
                            <tr{if="!$value1->estado"} class="danger"{/if}>
                                <td>
                                    <select name="codalmacen" class="form-control">
                                        {loop="$fsc->almacen->all()"}
                                        {if="$value1->codalmacen==$value2->codalmacen"}
                                        <option value="{$value2->codalmacen}" selected="">{$value2->nombre}</option>
                                        {else}
                                        <option value="{$value2->codalmacen}">{$value2->nombre}</option>
                                        {/if}
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <input type="text" name="supervisor" readonly value="{$value1->nombre_supervisor}" class="form-control"/>
                                </td>
                                <td>
                                    <input type="text" name="agente" readonly value="{$value1->nombre}" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            {if="$value->estado"}
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                            {else}
                                            <input type="checkbox" name="estado" value="TRUE"/>
                                            {/if}
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <input type='hidden' name='codagente' value='{$value1->codagente}'>
                                        <input type='hidden' name='type' value='vendedor'>
                                        {if="$fsc->allow_delete"}
                                            {if="$value->tiene_rutas_asignadas"}
                                                <a class="btn btn-sm btn-warning pull-left" onclick="bootbox.alert('No puedes eliminar este Vendedor porque tiene rutas asignadas.')">
                                                    <span class="glyphicon glyphicon-lock"></span>
                                                </a>
                                            {else}
                                                <button class="btn btn-sm btn-danger" type="button" title="Eliminar" onclick="borrar('Vendedor','{$value->codagente}','{$value->codalmacen}')">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                                document.f_vendedores.submit();" title="Guardar">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </form>
                        {/loop}
                        <form name="n_vendedores" id="n_vendedores" action="{$fsc->url()}" method="post" class="form">
                            <tr class="info">
                                <td>
                                    <select name="codalmacen" class="form-control">
                                        {loop="$fsc->almacen->all()"}
                                        <option value="{$value->codalmacen}">{$value->nombre}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <select name="codsupervisor" class="form-control">
                                        {loop="$fsc->supervisores_asignados"}
                                        <option value="{$value->codagente}">{$value->nombre}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <select name="codagente" class="form-control">
                                        {loop="$fsc->vendedores_libres"}
                                        <option value="{$value->codagente}">{$value->nombre} {$value->apellidos}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <input type='hidden' name='type' value='vendedor'>
                                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                            document.n_vendedores.submit();" title="Guardar">
                                        <span class="glyphicon glyphicon-floppy-disk"></span>
                                    </button>
                                </td>
                            </tr>
                        </form>
                    </table>
                </div>
            </div>
            <div class="panel panel-info hidden" id="panel_rutas">
                <div class="panel-heading">
                    <h3 class="panel-title">Rutas</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="text-left">Vendedor</th>
                                <th class="text-left">Código Ruta</th>
                                <th class="text-left">Descripción Ruta</th>
                                <th class="text-center">Días de Visita</th>
                                <th class="text-center">Activo</th>
                                <th width="120"></th>
                            </tr>
                        </thead>
                        {loop="$fsc->rutas"}
                        <form name="f_rutas{$value1->ruta}" id="f_rutas{$value1->ruta}" method="POST" action="{$fsc->url()}" class="form">
                            <tr{if="!$value->estado"} class="danger"{/if}>
                                <td>
                                    <select name="codagente" class="form-control">
                                        {loop="$fsc->vendedores_asignados"}
                                        <option {if="$value1->codagente==$value2->codagente"}selected{/if} value="{$value2->codagente}">{$value2->codagente} {$value2->nombre}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <input type="text" name="ruta" readonly value="{$value1->ruta}" class="form-control"/>
                                </td>
                                <td>
                                    <input type="text" name="descripcion" value="{$value1->descripcion}" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group" data-toggle="buttons">
                                        <label id="lunes{$value->ruta}" class="btn btn-default {if="$value->lunes"}active{/if}">
                                            <input name="lunes" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->lunes"}checked{/if} onchange="checkboxAction(this)"> Lu
                                        </label>
                                        <label id="martes{$value->ruta}" class="btn btn-default {if="$value->martes"}active{/if}">
                                            <input name="martes" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->martes"}checked{/if} onchange="checkboxAction(this)"> Ma
                                        </label>
                                        <label id="miercoles{$value->ruta}" class="btn btn-default {if="$value->miercoles"}active{/if}">
                                            <input name="miercoles" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->miercoles"}checked{/if} onchange="checkboxAction(this)"> Mi
                                        </label>
                                        <label id="jueves{$value->ruta}" class="btn btn-default {if="$value->jueves"}active{/if}">
                                            <input name="jueves" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->jueves"}checked{/if} onchange="checkboxAction(this)"> Ju
                                        </label>
                                        <label id="viernes{$value->ruta}" class="btn btn-default {if="$value->viernes"}active{/if}">
                                            <input name="viernes" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->viernes"}checked{/if} onchange="checkboxAction(this)"> Vi
                                        </label>
                                        <label id="sabado{$value->ruta}" class="btn btn-default {if="$value->sabado"}active{/if}">
                                            <input name="sabado" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->sabado"}checked{/if} onchange="checkboxAction(this)"> Sa
                                        </label>
                                        <label id="domingo{$value->ruta}" class="btn btn-default {if="$value->domingo"}active{/if}">
                                            <input name="domingo" ruta="{$value->ruta}" type="checkbox" autocomplete="off" {if="$value->domingo"}checked{/if} onchange="checkboxAction(this)"> Do
                                        </label>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            {if="$value->estado"}
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                            {else}
                                            <input type="checkbox" name="estado" value="TRUE"/>
                                            {/if}
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <input type='hidden' name='type' value='ruta'>
                                        {if="$fsc->allow_delete"}
                                            {if="$value->tiene_asignados"}
                                                <a class="btn btn-sm btn-warning pull-left" onclick="bootbox.alert('No puedes eliminar esta Ruta porque tiene clientes asignados.')">
                                                    <span class="glyphicon glyphicon-lock"></span>
                                                </a>
                                            {else}
                                                <button class="btn btn-sm btn-danger" type="button" title="Eliminar" onclick="borrar('Ruta','{$value->ruta}','{$value->codalmacen}')">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                                document.f_rutas{$value1->ruta}.submit();" title="Guardar">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                            </td>
                            </tr>
                        </form>
                        {/loop}
                        <form name="n_rutas" id="n_rutas" action="{$fsc->url()}" method="POST" class="form">
                            <tr class="info">
                                <td>
                                    <select name="codagente" class="form-control">
                                        {loop="$fsc->vendedores_asignados"}
                                        <option value="{$value->codagente}">{$value->nombre}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    
                                </td>
                                <td>
                                    <input type="text" name="descripcion" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group" data-toggle="buttons">
                                        <label id="nlunes" class="btn btn-default">
                                            <input name="lunes" var="n" type="checkbox" autocomplete="off"> Lu
                                        </label>
                                        <label id="nmartes" class="btn btn-default">
                                            <input name="martes" var="n" type="checkbox" autocomplete="off"> Ma
                                        </label>
                                        <label id="nmiercoles" class="btn btn-default">
                                            <input name="miercoles" var="n" type="checkbox" autocomplete="off"> Mi
                                        </label>
                                        <label id="njueves" class="btn btn-default">
                                            <input name="jueves" var="n" type="checkbox" autocomplete="off"> Ju
                                        </label>
                                        <label id="nviernes" class="btn btn-default">
                                            <input name="viernes" var="n" type="checkbox" autocomplete="off"> Vi
                                        </label>
                                        <label id="nsabado" class="btn btn-default">
                                            <input name="sabado" var="n" type="checkbox" autocomplete="off"> Sa
                                        </label>
                                        <label id="ndomingo" class="btn btn-default">
                                            <input name="domingo" var="n" type="checkbox" autocomplete="off"> Do
                                        </label>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <input type='hidden' name='type' value='ruta'>
                                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                            document.n_rutas.submit();" title="Guardar">
                                        <span class="glyphicon glyphicon-floppy-disk"></span>
                                    </button>
                                </td>
                            </tr>
                        </form>
                     </table>
                  </div>
              </div>
            <div class="panel panel-info hidden" id="panel_canales">
                <div class="panel-heading">
                    <h3 class="panel-title">Canales</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="text-left">Código Canal</th>
                                <th class="text-left">Descripción Canal</th>
                                <th class="text-center">Tarifa Asignada</th>
                                <th class="text-center">Activo</th>
                                <th width="120"></th>
                            </tr>
                        </thead>
                        {loop="$fsc->canales"}
                        <form name="f_canales{$value1->codigo}" id="f_canales{$value1->codigo}" method="POST" action="{$fsc->url()}" class="form">
                            <tr{if="!$value->estado"} class="danger"{/if}>
                                <td>
                                    <input type="text" name="canal" readonly value="{$value1->codigo}" class="form-control"/>
                                </td>
                                <td>
                                    <input type="text" name="descripcion" value="{$value1->descripcion}" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    Proximamente
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            {if="$value->estado"}
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                            {else}
                                            <input type="checkbox" name="estado" value="TRUE"/>
                                            {/if}
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <input type='hidden' name='type' value='canal'>
                                        {if="$fsc->allow_delete"}
                                            {if="$value->tiene_asignados"}
                                                <a class="btn btn-sm btn-warning pull-left" onclick="bootbox.alert('No puedes eliminar este Canal porque tiene clientes asignados.')">
                                                    <span class="glyphicon glyphicon-lock"></span>
                                                </a>
                                            {else}
                                                <button class="btn btn-sm btn-danger" type="button" title="Eliminar" onclick="borrar('Canal','{$value->codigo}','')">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                                document.f_canales{$value1->codigo}.submit();" title="Guardar">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </form>
                        {/loop}
                        <form name="n_canales" id="n_canales" action="{$fsc->url()}" method="POST" class="form">
                            <tr class="info">
                                <td>

                                </td>
                                <td>
                                    <input type="text" name="descripcion" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    Proximamente
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <input type='hidden' name='type' value='canal'>
                                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                            document.n_canales.submit();" title="Guardar">
                                        <span class="glyphicon glyphicon-floppy-disk"></span>
                                    </button>
                                </td>
                            </tr>
                        </form>
                    </table>
                </div>
            </div>
            <div class="panel panel-info hidden" id="panel_subcanales">
                <div class="panel-heading">
                    <h3 class="panel-title">Subcanales</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="text-left">Código Canal</th>
                                <th class="text-left">Código Subcanal</th>
                                <th class="text-left">Descripción Subcanal</th>
                                <th class="text-center">Tarifa Asignada</th>
                                <th class="text-center">Activo</th>
                                <th width="120"></th>
                            </tr>
                        </thead>
                        {loop="$fsc->subcanales"}
                        <form name="f_subcanales{$value1->codigo}" id="f_subcanales{$value1->codigo}" method="POST" action="{$fsc->url()}" class="form">
                            <tr{if="!$value->estado"} class="danger"{/if}>
                                <td>
                                    <select name="canal" class="form-control">
                                        {loop="$fsc->canales"}
                                        <option value="{$value2->codigo}" {if="$value1->codigo_padre==$value2->codigo"}selected{/if}>{$value2->descripcion}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>
                                    <input type="text" name="subcanal" readonly value="{$value1->codigo}" class="form-control"/>
                                </td>
                                <td>
                                    <input type="text" name="descripcion" value="{$value1->descripcion}" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    Proximamente
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            {if="$value->estado"}
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                            {else}
                                            <input type="checkbox" name="estado" value="TRUE"/>
                                            {/if}
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <input type='hidden' name='type' value='subcanal'>
                                        {if="$fsc->allow_delete"}
                                            {if="$value->tiene_asignados"}
                                                <a class="btn btn-sm btn-warning pull-left" onclick="bootbox.alert('No puedes eliminar este Subcanal porque tiene clientes asignados.')">
                                                    <span class="glyphicon glyphicon-lock"></span>
                                                </a>
                                            {else}
                                                <button class="btn btn-sm btn-danger" type="button" title="Eliminar" onclick="borrar('Subcanal','{$value->codigo}','')">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                                document.f_subcanales{$value1->codigo}.submit();" title="Guardar">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </form>
                        {/loop}
                        <form name="n_subcanales" id="n_subcanales" action="{$fsc->url()}" method="POST" class="form">
                            <tr class="info">
                                <td>
                                    <select name="canal" class="form-control">
                                        {loop="$fsc->canales_activos"}
                                        <option value="{$value->codigo}">{$value->descripcion}</option>
                                        {/loop}
                                    </select>
                                </td>
                                <td>

                                </td>
                                <td>
                                    <input type="text" name="descripcion" class="form-control"/>
                                </td>
                                <td class="text-center">
                                    Proximamente
                                </td>
                                <td class="text-center">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="estado" value="TRUE" checked=""/>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <input type='hidden' name='type' value='subcanal'>
                                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                                            document.n_subcanales.submit();" title="Guardar">
                                        <span class="glyphicon glyphicon-floppy-disk"></span>
                                    </button>
                                </td>
                            </tr>
                        </form>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" name='menu_activo' id='menu_activo' value="{$fsc->type}">
<script type="text/javascript">
    /*
     * Cambia la clase a boton primario cuando el usuario le da Click y muestra el panel asociado
     */
    function botonActivo(element) {
        var botones = ['b_supervisores', 'b_vendedores', 'b_rutas', 'b_canales', 'b_subcanales'];
        var paneles = ['panel_supervisores', 'panel_vendedores', 'panel_rutas', 'panel_canales', 'panel_subcanales'];
        $('#panel_central').hide();
        for (var i = 0; i < botones.length; i++) {
            var idElement = '#' + element.id;
            var otherElement = '#' + botones[i];
            var idPanel = '#' + paneles[i];
            if (element.id === botones[i]) {
                $(idElement).removeClass("btn-default");
                $(idElement).addClass("btn-primary");
                $(idPanel).removeClass('hidden');
            } else {
                $(otherElement).removeClass("btn-primary");
                $(otherElement).addClass("btn-default");
                $(idPanel).addClass('hidden');
            }
        }
    }
    
    function borrar(objeto, codigo, almacen){
        bootbox.dialog({
            message: "Esta seguro que quiere eliminar al "+objeto+"?",
            title: "Eliminar "+objeto,
            buttons: {
                success: {
                    label: "Eliminar",
                    className: "btn-success",
                    callback: function() {
                        $.ajax({
                            type: 'POST',
                            url: '{$fsc->url()}',
                            async: false,
                            data: 'type='+objeto.toLowerCase()+'&codagente='+codigo+'&codalmacen='+almacen+'&borrar=TRUE',
                            success : function(datos) {
                                 bootbox.alert(datos.mensaje, function() {
                                    window.location.assign("{$fsc->url()}");
                                 });
                            },
                            error: function() {
                                bootbox.alert("Ocurrio un error no contemplado en el plugin, por favor envie un mensaje en el foro de soporte de FacturaScripts para verificar el problema, gracias.");
                            }
                        });
                    }
                },
                danger: {
                    label: "Cancelar",
                    className: "btn-danger",
                    callback: function() {
                        this.hide();
                    }
                }
            }
        });
    }

    function checkboxAction(element) {
        var elementType = element.getAttribute("var");
        var elementRuta = element.getAttribute("ruta");
        var idElement = (elementType === null) ? '#' + element.name : '#' + elementType + element.name + elementRuta;
        if (element.checked) {
            $(idElement).removeClass('btn-default');
            $(idElement).addClass('btn-primary');
        } else {
            $(idElement).removeClass('btn-primary');
            $(idElement).addClass('btn-default');
        }
    }
    
    if ($('#menu_activo').val() !== '') {
        $('#panel_central').hide();
        if ($('#menu_activo').val() === 'ruta') {
            $('#b_rutas').removeClass("btn-default");
            $('#b_rutas').addClass("btn-primary");
            $('#panel_rutas').removeClass('hidden');
        } else if ($('#menu_activo').val() === 'supervisor') {
            $('#b_supervisores').removeClass("btn-default");
            $('#b_supervisores').addClass("btn-primary");
            $('#panel_supervisores').removeClass('hidden');
        } else if ($('#menu_activo').val() === 'vendedor') {
            $('#b_vendedores').removeClass("btn-default");
            $('#b_vendedores').addClass("btn-primary");
            $('#panel_vendedores').removeClass('hidden');
        } else if ($('#menu_activo').val() === 'canal') {
            $('#b_canales').removeClass("btn-default");
            $('#b_canales').addClass("btn-primary");
            $('#panel_canales').removeClass('hidden');
        } else if ($('#menu_activo').val() === 'subcanal') {
            $('#b_subcanales').removeClass("btn-default");
            $('#b_subcanales').addClass("btn-primary");
            $('#panel_subcanales').removeClass('hidden');
        }
    }
</script>
{include="footer"}