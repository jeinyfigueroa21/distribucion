{include="header2"}
<script src="plugins/distribucion/view/js/plugins/validator.min.js" type="text/javascript"></script>
<script type="text/javascript">
   function eliminar_devolucion(id)
   {
      if( confirm("¿Realmente desea eliminar la devolución?") )
         window.location.href = '{$fsc->url()}&delete='+id;
   }

    $(document).ready(function() {
      $('#f_devolucion').validator().on('submit', function (e) {
        if (e.isDefaultPrevented()) {
          alert('Formulario Invalido!');
        } else {
            if(confirm("¿Realmente desea guardar la devolución?"))
                return true;
        }
      });
   });
</script>
<div class="container-fluid">
    <form action="{$fsc->url()}" method="post" data-toggle="validator" role="form" class="form" name="f_devolucion" id="f_devolucion">
        {if="$fsc->devolucion"}
        <div class="row panel-info">
            <span class="col-sm-2">Nota de Crédito de deVolución:</span><span><b>{if="$fsc->resultados->numero2!=''"}{$fsc->resultados->numero2}{else}{$fsc->resultados->idfactura}{/if}</b></span>
        </div>
        {/if}
        <input type="hidden" name="id" value="{$fsc->factura}">
        <input type="hidden" name="type" value="devolucion">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th class="text-left">Referencia</th>
                    <th class="text-left">Producto</th>
                    <th class="text-right">Precio</th>
                    <th class="text-center">Impuestos</th>
                    <th class="text-right">Neto</th>
                    <th class="text-center">Cantidad</th>
                    {if="!$fsc->devolucion"}
                        <th class="text-center">Devolución</th>
                    {else}
                        <th class="text-center">&nbsp;</th>
                    {/if}
                </tr>
            </thead>
            {loop="$fsc->resultados->get_lineas()"}
                <tr>
                    <td>{$value1->referencia}</td>
                    <td>{$value1->descripcion}</td>
                    <td class='text-right'>{$fsc->show_precio($value1->pvpunitario)}</td>
                    <td class='text-center'>{$value1->iva}</td>
                    <td class='text-right'>{$fsc->show_precio($value1->pvptotal)}</td>
                    <td class='text-center'>{$value1->cantidad}</td>
                    {if="!$fsc->devolucion"}
                        <td class='text-center'><input name="id_{$value1->referencia}" type="number" step="0.0001" min="0" max="{$value1->cantidad}" required></td>
                    {else}
                        <td>&nbsp;</td>
                    {/if}
                </tr>
            {/loop}
            <tr>
                <td colspan='3'>&nbsp;</td>
                <th class="text-right">Impuestos</th>
                <th class="text-right">Valor Neto</th>
                <th class="text-right">Valor Total</th>
            </tr>
            <tr>
                <td colspan='3'>&nbsp;</td>
                <td class="text-right"><b>{$fsc->show_precio($fsc->resultados->totaliva)}</b></td>
                <td class="text-right"><b>{$fsc->show_precio($fsc->resultados->neto)}</b></td>
                <td class="text-right"><b>{$fsc->show_precio($fsc->resultados->total)}</b></td>
            </tr>
            <tfoot>
                <tr>
                    <td class="text-right" colspan="7">
                        <button id="b_guardar" data-disable="true" type="submit" class="btn btn-sm btn-primary">
                            <span class="glyphicon glyphicon-floppy-disk"></span>
                            &nbsp; Guardar Devolución
                        </button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    </form>
    <div class="row">Aqui puede generar las devoluciones parciales para esta factura, por favor verifique bien las cantidades ingresadas, ya que una vez guardada la devolución, solo el contador podrá reversar la misma.</div>
</div>
{include="footer2"}