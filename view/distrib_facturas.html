{include="header2"}
<script src="plugins/distribucion/view/js/plugins/validator.min.js" type="text/javascript"></script>
<script type="text/javascript">
   function eliminar_devolucion(id)
   {
      if( confirm("¿Realmente desea eliminar la devolución?") )
         window.location.href = '{$fsc->url()}&delete='+id;
   }
   
    $(document).ready(function() {
      $('#f_devolucion').validator().on('submit', function (e) {
        if (e.isDefaultPrevented()) {
          alert('Formulario Invalido!');
        } else {
            if(confirm("¿Realmente desea guardar la devolución?"))
                return true;
        }
      });
   });
</script>
<div class="container-fluid">
    <form action="{$fsc->url()}" method="post" data-toggle="validator" role="form" class="form" name="f_devolucion" id="f_devolucion">
        <input type="hidden" name="id" value="{$fsc->factura}">
        <input type="hidden" name="type" value="devolucion">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th class="text-left">Referencia</th>
                    <th class="text-left">Producto</th>
                    <th class="text-right">Precio</th>
                    <th class="text-center">Impuestos</th>
                    <th class="text-right">Neto</th>
                    <th class="text-center">Cantidad</th>
                    <th class="text-center">Devolución</th>
                    <th class="text-right">Valor Dev</th>
                </tr>
            </thead>
            {loop="$fsc->resultados"}
                <tr>
                    <td>{$value1->referencia}</td>
                    <td>{$value1->descripcion}</td>
                    <td class='text-right'>{$fsc->show_precio($value1->pvpunitario)}</td>
                    <td class='text-center'>{$value1->iva}</td>
                    <td class='text-right'>{$fsc->show_precio($value1->pvptotal)}</td>
                    <td class='text-center'>{$value1->cantidad} {$value1->devolucion}</td>
                    {if="$value1->devolucion==''"}
                        <td class='text-center'><input name="{$value1->referencia}" type="number" min="0" max="{$value1->cantidad}" required></td>
                        <td>&nbsp;</td>
                    {else}
                        <td class='text-center'>{$value1->devolucion}</td>
                        <td class='text-right'>{$fsc->show_precio($value1->devolucionneto)}</td>
                    {/if}
                    
                </tr>
            {/loop}
            <tfoot>
                <tr>
                    <td class="text-right" colspan="8">
                        {if="$fsc->allow_delete"}
                        <button id="b_eliminar" type="button" onclick="this.disabled=true;" title="Guardar" class="btn btn-sm btn-danger">
                            <span class="glyphicon glyphicon-trash"></span>
                            &nbsp; Eliminar Devolución
                        </button>
                        {/if}
                        <button id="b_guardar" data-disable="true" type="submit" class="btn btn-sm btn-primary">
                            <span class="glyphicon glyphicon-floppy-disk"></span>
                            &nbsp; Guardar Devolución
                        </button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    </form>
    <div class="row">Aqui puede generar las devoluciones parciales para esta factura, por favor verifique bien las cantidades ingresadas, ya que una vez guardada la devolución, solo el contador podrá reversar la misma.</div>
</div>
{include="footer2"}